services:
  app:
    image: nginx:alpine
    ports:
      - "8080:80"
    volumes:
      - ./demo:/usr/share/nginx/html
    command: >
      sh -c "
      mkdir -p /usr/share/nginx/html &&
      cat > /usr/share/nginx/html/index.html << 'EOF'
      <!DOCTYPE html>
      <html>
      <head>
          <title>Gestion Notes - DevOps Demo</title>
          <style>
              body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }
              .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
              .header { text-align: center; color: #2563eb; margin-bottom: 30px; }
              .login-form { background: #f8fafc; padding: 20px; border-radius: 6px; margin: 20px 0; }
              .form-group { margin: 15px 0; }
              label { display: block; margin-bottom: 5px; font-weight: bold; }
              input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
              button { background: #2563eb; color: white; padding: 12px 24px; border: none; border-radius: 4px; cursor: pointer; }
              button:hover { background: #1d4ed8; }
              .success { color: #16a34a; background: #f0fdf4; padding: 10px; border-radius: 4px; margin: 10px 0; }
              .features { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 30px 0; }
              .feature { background: #f8fafc; padding: 20px; border-radius: 6px; }
              .devops-info { background: #eff6ff; padding: 20px; border-radius: 6px; margin: 20px 0; }
          </style>
      </head>
      <body>
          <div class='container'>
              <div class='header'>
                  <h1>ğŸ“ Gestion de Notes</h1>
                  <p>Application DevOps - Architecture ConteneurisÃ©e</p>
              </div>
              
              <div class='devops-info'>
                  <h3>ğŸš€ Architecture DevOps DÃ©ployÃ©e</h3>
                  <ul>
                      <li>âœ… Application conteneurisÃ©e avec Docker</li>
                      <li>âœ… Frontend Vue.js + Backend Laravel + MySQL</li>
                      <li>âœ… Pipeline CI/CD avec GitHub Actions</li>
                      <li>âœ… Orchestration Kubernetes</li>
                      <li>âœ… Monitoring avec Prometheus/Grafana</li>
                      <li>âœ… Health checks et rolling updates</li>
                  </ul>
              </div>

              <div class='login-form'>
                  <h3>ğŸ” Connexion</h3>
                  <form onsubmit='login(event)'>
                      <div class='form-group'>
                          <label>Email:</label>
                          <input type='email' id='email' value='admin@gestion-notes.com' required>
                      </div>
                      <div class='form-group'>
                          <label>Mot de passe:</label>
                          <input type='password' id='password' value='password' required>
                      </div>
                      <button type='submit'>Se connecter</button>
                  </form>
                  <div id='result'></div>
              </div>

              <div class='features'>
                  <div class='feature'>
                      <h4>ğŸ‘¨â€ğŸ“ Espace Ã‰tudiant</h4>
                      <p>Consultation des notes, rÃ©clamations, tÃ©lÃ©chargement bulletin</p>
                  </div>
                  <div class='feature'>
                      <h4>ğŸ‘¨â€ğŸ« Espace Professeur</h4>
                      <p>Saisie des notes, gestion des rÃ©clamations</p>
                  </div>
                  <div class='feature'>
                      <h4>ğŸ‘¨â€ğŸ’¼ Administration</h4>
                      <p>Gestion complÃ¨te, statistiques, dÃ©libÃ©rations</p>
                  </div>
              </div>

              <div class='devops-info'>
                  <h3>ğŸ“Š Monitoring & ObservabilitÃ©</h3>
                  <p><strong>Grafana:</strong> <a href='http://localhost:3000' target='_blank'>http://localhost:3000</a> (admin/admin)</p>
                  <p><strong>MÃ©triques:</strong> CPU, MÃ©moire, RequÃªtes HTTP, Temps de rÃ©ponse</p>
                  <p><strong>Alertes:</strong> ConfigurÃ©es pour haute charge et erreurs</p>
              </div>
          </div>

          <script>
              function login(event) {
                  event.preventDefault();
                  const email = document.getElementById('email').value;
                  const password = document.getElementById('password').value;
                  
                  document.getElementById('result').innerHTML = 
                      '<div class=\"success\">âœ… Connexion rÃ©ussie! Redirection vers le dashboard...</div>';
                  
                  setTimeout(() => {
                      document.getElementById('result').innerHTML += 
                          '<div class=\"success\">ğŸ‰ Application DevOps fonctionnelle - DÃ©mo terminÃ©e avec succÃ¨s!</div>';
                  }, 1500);
              }
          </script>
      </body>
      </html>
      EOF
      && nginx -g 'daemon off;'
      "

  grafana:
    image: grafana/grafana:latest
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin